<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Aura Inspector - Live Runtime Dashboard</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #1e1e1e;
                color: #d4d4d4;
                height: 100vh;
                overflow: hidden;
            }

            .container {
                display: grid;
                grid-template-rows: 60px 1fr 200px;
                height: 100vh;
            }

            /* Header */
            .header {
                background: #252526;
                border-bottom: 1px solid #007acc;
                display: flex;
                align-items: center;
                padding: 0 20px;
                justify-content: space-between;
            }

            .header h1 {
                font-size: 20px;
                color: #007acc;
            }

            .status {
                display: flex;
                gap: 15px;
                align-items: center;
            }

            .status-indicator {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: #4ec9b0;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            /* Main Content */
            .main-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1px;
                background: #2d2d30;
                overflow: hidden;
            }

            .panel {
                background: #1e1e1e;
                padding: 15px;
                overflow-y: auto;
            }

            .panel h2 {
                color: #4ec9b0;
                font-size: 14px;
                margin-bottom: 15px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .panel-content {
                font-size: 13px;
                line-height: 1.6;
            }

            /* Variables */
            .variable {
                display: flex;
                justify-content: space-between;
                padding: 8px;
                margin: 4px 0;
                background: #252526;
                border-left: 3px solid #007acc;
                border-radius: 2px;
            }

            .variable-name {
                color: #9cdcfe;
                font-weight: 600;
            }

            .variable-value {
                color: #ce9178;
            }

            /* Functions */
            .function-item {
                padding: 8px;
                margin: 4px 0;
                background: #252526;
                border-left: 3px solid #c586c0;
                border-radius: 2px;
                color: #dcdcaa;
            }

            /* Events */
            .event-item {
                padding: 8px;
                margin: 4px 0;
                background: #252526;
                border-left: 3px solid #4ec9b0;
                border-radius: 2px;
            }

            /* Memory */
            .memory-stat {
                display: flex;
                justify-content: space-between;
                padding: 8px;
                margin: 4px 0;
            }

            .memory-label {
                color: #9cdcfe;
            }

            .memory-value {
                color: #b5cea8;
                font-weight: 600;
            }

            /* Console */
            .console {
                background: #1e1e1e;
                border-top: 1px solid #007acc;
                display: flex;
                flex-direction: column;
            }

            .console-header {
                padding: 10px 15px;
                background: #252526;
                font-size: 12px;
                color: #4ec9b0;
                text-transform: uppercase;
            }

            .console-output {
                flex: 1;
                padding: 10px;
                overflow-y: auto;
                font-family: 'Consolas', 'Monaco', monospace;
                font-size: 12px;
            }

            .console-input {
                padding: 10px;
                background: #252526;
                border-top: 1px solid #2d2d30;
            }

            .console-input input {
                width: 100%;
                background: #3c3c3c;
                border: 1px solid #007acc;
                color: #d4d4d4;
                padding: 8px;
                font-family: 'Consolas', 'Monaco', monospace;
                font-size: 13px;
                outline: none;
            }

            .console-input input:focus {
                border-color: #4ec9b0;
            }

            .console-line {
                margin: 2px 0;
            }

            .console-prompt {
                color: #4ec9b0;
            }

            .console-command {
                color: #9cdcfe;
            }

            .console-output-text {
                color: #ce9178;
            }

            /* Empty state */
            .empty-state {
                color: #6a6a6a;
                font-style: italic;
                padding: 20px;
                text-align: center;
            }

            ::-webkit-scrollbar {
                width: 8px;
            }

            ::-webkit-scrollbar-track {
                background: #1e1e1e;
            }

            ::-webkit-scrollbar-thumb {
                background: #3c3c3c;
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #007acc;
            }
        </style>
    </head>
    <body>
        <div
            class="container">
            <!-- Header -->
            <div class="header">
                <h1>üîç Aura Inspector</h1>
                <div class="status">
                    <div class="status-indicator"></div>
                    <span id="status-text">Connected</span>
                </div>
            </div>

            <!-- Main Content -->
            <div
                class="main-content">
                <!-- Variables Panel -->
                <div class="panel">
                    <h2>üìä Variables</h2>
                    <div id="variables" class="panel-content">
                        <div class="empty-state">No variables defined</div>
                    </div>
                </div>

                <!-- Functions Panel -->
                <div class="panel">
                    <h2>‚ö° Functions</h2>
                    <div id="functions" class="panel-content">
                        <div class="empty-state">No functions defined</div>
                    </div>
                </div>

                <!-- Events Panel -->
                <div class="panel">
                    <h2>üì° Events</h2>
                    <div id="events" class="panel-content">
                        <div class="empty-state">No events queued</div>
                    </div>
                </div>

                <!-- Memory Panel -->
                <div class="panel">
                    <h2>üíæ Memory</h2>
                    <div id="memory" class="panel-content">
                        <div class="empty-state">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Console -->
            <div class="console">
                <div class="console-header">Console</div>
                <div id="console-output" class="console-output">
                    <div class="console-line">
                        <span class="console-output-text">Aura Inspector - Type commands below</span>
                    </div>
                </div>
                <div class="console-input">
                    <input type="text" id="console-input" placeholder="Enter command (e.g., 'pause', 'inspect state')">
                </div>
            </div>
        </div>

        <script>
            // WebSocket connection
            let ws = null;
            let reconnectInterval = null;

            function connect() {
                ws = new WebSocket('ws://localhost:8080');

                ws.onopen = () => {
                    console.log('Connected to Aura runtime');
                    document.getElementById('status-text').textContent = 'Connected';
                    clearInterval(reconnectInterval);
                };

                ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);

                    if (message.type === 'state_update') {
                        updateDashboard(message.data);
                    } else if (message.type === 'error') {
                        logToConsole('Error: ' + message.message, 'error');
                    }
                };

                ws.onclose = () => {
                    console.log('Disconnected from Aura runtime');
                    document.getElementById('status-text').textContent = 'Disconnected';

                    // Auto-reconnect
                    reconnectInterval = setInterval(connect, 2000);
                };

                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };
            }

            function updateDashboard(data) { // Update variables
                const varsEl = document.getElementById('variables');
                if (data.variables && Object.keys(data.variables).length > 0) {
                    varsEl.innerHTML = Object.entries(data.variables).map(([name, value]) => `
                        <div class="variable">
                            <span class="variable-name">${name}</span>
                            <span class="variable-value">${
                        JSON.stringify(value)
                    }</span>
                        </div>
                    `).join('');
                } else {
                    varsEl.innerHTML = '<div class="empty-state">No variables defined</div>';
                }

                // Update functions
                const funcsEl = document.getElementById('functions');
                if (data.functions && data.functions.length > 0) {
                    funcsEl.innerHTML = data.functions.map(name => `<div class="function-item">${name}()</div>`).join('');
                } else {
                    funcsEl.innerHTML = '<div class="empty-state">No functions defined</div>';
                }

                // Update events
                const eventsEl = document.getElementById('events');
                if (data.events) {
                    eventsEl.innerHTML = `
                    <div class="event-item">
                        <div>Pending: ${
                        data.events.pending || 0
                    }</div>
                        <div>Processed: ${
                        data.events.processed || 0
                    }</div>
                    </div>
                `;
                }

                // Update memory
                const memEl = document.getElementById('memory');
                if (data.memory) {
                    memEl.innerHTML = `
                    <div class="memory-stat">
                        <span class="memory-label">Variables:</span>
                        <span class="memory-value">${
                        data.memory.variables.count
                    }</span>
                    </div>
                    <div class="memory-stat">
                        <span class="memory-label">Functions:</span>
                        <span class="memory-value">${
                        data.memory.functions.count
                    }</span>
                    </div>
                    <div class="memory-stat">
                        <span class="memory-label">Events Pending:</span>
                        <span class="memory-value">${
                        data.memory.events.pending
                    }</span>
                    </div>
                    <div class="memory-stat">
                        <span class="memory-label">Stack Depth:</span>
                        <span class="memory-value">${
                        data.memory.call_stack_depth
                    }</span>
                    </div>
                `;
                }
            }

            function logToConsole(text, type = 'output') {
                const output = document.getElementById('console-output');
                const line = document.createElement('div');
                line.className = 'console-line';

                if (type === 'command') {
                    line.innerHTML = `<span class="console-prompt">aura></span> <span class="console-command">${text}</span>`;
                } else {
                    line.innerHTML = `<span class="console-output-text">${text}</span>`;
                } output.appendChild(line);
                output.scrollTop = output.scrollHeight;
            }

            // Console input
            document.getElementById('console-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const command = e.target.value.trim();
                    if (command && ws && ws.readyState === WebSocket.OPEN) {
                        logToConsole(command, 'command');

                        ws.send(JSON.dumps({type: 'execute_command', command: command}));

                        e.target.value = '';
                    }
                }
            });

            // Connect on load
            connect();
        </script>
    </body>
</html>
